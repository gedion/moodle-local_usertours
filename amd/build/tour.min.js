!function(a,b){"function"==typeof define&&define.amd?define(["jquery","local_usertours/popper"],function(c,d){return a.Tour=b(c,d)}):"object"==typeof exports?module.exports=b(require("jquery"),require("popper.js")):a.Tour=b($,Popper)}(this,function(a,b){"use strict";function c(a){this.init(a)}var d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol?"symbol":typeof a};return c.prototype.tourName,c.prototype.originalConfiguration,c.prototype.listeners,c.prototype.eventHandlers,c.prototype.steps,c.prototype.currentStepNode,c.prototype.currentStepNumber,c.prototype.currentStepPopper,c.prototype.currentStepConfig,c.prototype.templateContent,c.prototype.init=function(a){return this.eventHandlers={},this.reset(),this.originalConfiguration=a||{},this.sessionStorage={},this.configure.apply(this,arguments),this},c.prototype.reset=function(){return this.hide(),this.eventHandlers=[],this.resetStepListeners(),this.originalConfiguration={},this.steps=[],this.currentStepNumber=0,this},c.prototype.configure=function(a){var b=this;return"object"===("undefined"==typeof a?"undefined":d(a))&&("undefined"!=typeof a.tourName&&(this.tourName=a.tourName),a.eventHandlers&&!function(){var c=void 0;for(c in a.eventHandlers)a.eventHandlers[c].forEach(function(a){this.addEventHandler(c,a)},b)}(),this.resetStepDefaults(!0),"object"===d(a.steps)&&(this.steps=a.steps),"undefined"!=typeof a.template&&(this.templateContent=a.template)),this.checkMinimumRequirements(),this},c.prototype.checkMinimumRequirements=function(){if(!this.tourName)throw new Error("Tour Name required");if(!this.steps||!this.steps.length)throw new Error("Steps must be specified")},c.prototype.resetStepDefaults=function(a){return"undefined"==typeof a&&(a=!0),this.stepDefaults={},a&&"undefined"!=typeof this.originalConfiguration.stepDefaults?this.setStepDefaults(this.originalConfiguration.stepDefaults):this.setStepDefaults({}),this},c.prototype.setStepDefaults=function(b){return this.stepDefaults||(this.stepDefaults={}),a.extend(this.stepDefaults,{element:"",placement:"top",delay:0,moveOnClick:!1,moveAfterTime:0,orphan:!1},b),this},c.prototype.getCurrentStepNumber=function(){return parseInt(this.currentStepNumber,10)},c.prototype.setCurrentStepNumber=function(a){this.currentStepNumber=a},c.prototype.getNextStepNumber=function(a){"undefined"==typeof a&&(a=this.getCurrentStepNumber());for(var b=a+1;b<=this.steps.length;){if(this.isStepPotentiallyVisible(this.getStepConfig(b)))return b;b++}return null},c.prototype.getPreviousStepNumber=function(a){"undefined"==typeof a&&(a=this.getCurrentStepNumber());for(var b=a-1;b>=0;){if(this.isStepPotentiallyVisible(this.getStepConfig(b)))return b;b--}return null},c.prototype.isLastStep=function(a){var b=this.getNextStepNumber(a);return null===b},c.prototype.isFirstStep=function(a){var b=this.getPreviousStepNumber(a);return null===b},c.prototype.isStepPotentiallyVisible=function(a){return a?this.isStepActuallyVisible(a)?!0:"undefined"!=typeof a.orphan&&a.orphan?!0:"undefined"!=typeof a.delay&&a.delay?!0:!1:!1},c.prototype.isStepActuallyVisible=function(a){if(!a)return!1;var b=this.getStepTarget(a);return b&&b.length?!!b.length:!1},c.prototype.next=function(){return this.gotoStep(this.getNextStepNumber())},c.prototype.previous=function(){return this.gotoStep(this.getPreviousStepNumber())},c.prototype.gotoStep=function(a){var b=this.getStepConfig(a);return b?(this.hide(),this.fireEventHandlers("beforeRender",b),this.renderStep(b),this.fireEventHandlers("afterRender",b),this):this.endTour()},c.prototype.getStepConfig=function(b){if(null===b||0>b||b>=this.steps.length)return null;var c=this.normalizeStepConfig(this.steps[b]);return c=a.extend(c,{stepNumber:b})},c.prototype.normalizeStepConfig=function(b){return b=a.extend({},this.stepDefaults,b),b=a.extend({},{attachTo:b.target,attachPoint:"after"},b)},c.prototype.getStepTarget=function(b){return b.target?a(b.target):null},c.prototype.fireEventHandlers=function(a,b){return"undefined"==typeof this.eventHandlers[a]?this:(this.eventHandlers[a].forEach(function(a){a.call(this,b)},this),this)},c.prototype.addEventHandler=function(a,b){return"undefined"==typeof this.eventHandlers[a]&&(this.eventHandlers[a]=[]),this.eventHandlers[a].push(b),this},c.prototype.processStepListeners=function(b){if(this.listeners.push({node:this.currentStepNode,args:["click",'[data-role="next"]',a.proxy(this.next,this)]},{node:this.currentStepNode,args:["click",'[data-role="previous"]',a.proxy(this.previous,this)]},{node:this.currentStepNode,args:["click",'[data-role="end"]',a.proxy(this.endTour,this)]},{node:a("body"),args:["keydown",a.proxy(this.handleKeyDown,this)]}),b.moveOnClick){var c=this.getStepTarget(b);this.listeners.push({node:c,args:["click",a.proxy(this.next,this)]})}return this.listeners.forEach(function(a){a.node.on.apply(a.node,a.args)}),this},c.prototype.resetStepListeners=function(){return this.listeners&&this.listeners.forEach(function(a){a.node.off.apply(a.node,a.args)}),this.listeners=[],this},c.prototype.renderStep=function(b){this.currentStepConfig=b,this.setCurrentStepNumber(b.stepNumber);var c=a(this.getTemplateContent());return c.find('[data-placeholder="title"]').html(b.title),c.find('[data-placeholder="body"]').html(b.body),this.isFirstStep(b.stepNumber)?c.find('[data-role="previous"]').prop("disabled",!0):c.find('[data-role="previous"]').prop("disabled",!1),this.isLastStep(b.stepNumber)?c.find('[data-role="next"]').prop("disabled",!0):c.find('[data-role="next"]').prop("disabled",!1),c.find('[data-role="previous"]').attr("role","button"),c.find('[data-role="next"]').attr("role","button"),c.find('[data-role="end"]').attr("role","button"),b.template=c,this.addStepToPage(b),this.processStepListeners(b),this.announceStep(b),this},c.prototype.getTemplateContent=function(){return a(this.templateContent).clone()},c.prototype.addStepToPage=function(b){b.template;this.currentStepNode=a('<span data-flexitour="container"></span>').html(b.template).hide();var c=a("body, html").stop(!0,!0);if(this.isStepActuallyVisible(b)){var d=this.calculateZIndex(this.getStepTarget(b));d&&(b.zIndex=d+1),b.zIndex&&this.currentStepNode.css("zIndex",b.zIndex+1),this.positionBackdrop(b),"append"===b.attachPoint?a(b.attachTo).append(this.currentStepNode):this.currentStepNode.insertAfter(a(b.attachTo)),c.animate({scrollTop:this.calculateScrollTop(b)}),c.promise().then(a.proxy(function(){this.positionStep(b)},this))}else b.orphan&&(b.isOrphan=!0,b.attachTo="body",b.attachPoint="append",this.positionBackdrop(b),this.currentStepNode.addClass("orphan"),a(b.attachTo).append(this.currentStepNode),this.currentStepNode.offset(this.calculateStepPositionInPage()));return c.promise().done(a.proxy(function(){this.currentStepNode.fadeIn()},this)),this},c.prototype.announceStep=function(a){this.currentStepNode.attr("role","dialog"),this.currentStepNode.attr("tabindex",-1);var b="tour-step-"+this.tourName+"-"+a.stepNumber;this.currentStepNode.attr("id",b),this.currentStepNode.find('[data-placeholder="body"]').first().attr("id",b+"-body"),this.currentStepNode.find('[data-placeholder="title"]').first().attr("id",b+"-title"),this.currentStepNode.attr("aria-labelledby",b+"-title");var c=this.getStepTarget(a);return c?(c.attr("tabindex")||c.attr("tabindex",-1),c.data("original-describedby",c.attr("aria-describedby")).attr("aria-describedby",b+"-body").focus()):this.currentStepNode.focus(),this},c.prototype.handleKeyDown=function(b){var c="a[href], link[href], [draggable=true], [contenteditable=true], :input:enabled, [tabindex], button";switch(b.keyCode){case 27:this.endTour();break;case 117:(function(){if(!this.currentStepConfig.isOrphan){var b=a(document.activeElement),c=this.getStepTarget(this.currentStepConfig);this.currentStepNode.is(b)?c.focus():c.is(b)?this.currentStepNode.focus():b.closest(c).length?this.currentStepNode.focus():c.focus()}}).call(this);break;case 9:(function(){if(this.currentStepConfig.hasBackdrop){var d=a(document.activeElement),e=this.getStepTarget(this.currentStepConfig),f=a(c),g=void 0;f.filter(function(a,b){return d.is(b)?(g=a,!1):void 0});var h=void 0,i=void 0,j=void 0;if(g){var k=1;b.shiftKey&&(k=-1),h=g;do h+=k,i=a(f[h]);while(i.length&&i.is(":disabled")||i.is(":hidden"));i.length?(j=i.closest(e).length,j=j||i.closest(this.currentStepNode).length):j=!1}j?i.focus():b.shiftKey?this.currentStepNode.find(c).last().focus():this.currentStepConfig.isOrphan?this.currentStepNode.focus():e.focus(),b.preventDefault()}}).call(this)}},c.prototype.startTour=function(a){return"undefined"==typeof a&&(a=this.getCurrentStepNumber()),this.fireEventHandlers("beforeStart",a),this.gotoStep(a),this.fireEventHandlers("afterStart",a),this},c.prototype.restartTour=function(){return this.startTour(0)},c.prototype.endTour=function(){if(this.fireEventHandlers("beforeEnd"),this.currentStepConfig){var a=this.getStepTarget(this.currentStepConfig);a.attr("tabindex")||a.attr("tabindex","-1"),a.focus()}return this.hide(!0),this.fireEventHandlers("afterEnd"),this},c.prototype.hide=function(b){if(this.fireEventHandlers("beforeHide"),this.currentStepNode&&this.currentStepNode.length&&(this.currentStepNode.hide(),this.currentStepPopper&&this.currentStepPopper.destroy()),this.currentStepConfig){var c=this.getStepTarget(this.currentStepConfig);c&&(c.data("original-labelledby")&&c.attr("aria-labelledby",c.data("original-labelledby")),c.data("original-describedby")&&c.attr("aria-describedby",c.data("original-describedby")),c.data("original-tabindex")&&c.attr("tabindex",c.data("tabindex"))),this.currentStepConfig=null}var d=0;return b&&(d=400),a('[data-flexitour="step-background"]').remove(),a('[data-flexitour="step-backdrop"]').removeAttr("data-flexitour"),a('[data-flexitour="backdrop"]').fadeOut(d,function(){a(this).remove()}),this.resetStepListeners(),this.fireEventHandlers("afterHide"),this},c.prototype.show=function(){var a=this.getCurrentStepNumber();return this.gotoStep(a)},c.prototype.getStepContainer=function(){return a(this.currentStepNode)},c.prototype.calculateScrollTop=function(b){var c=a(window).scrollTop(),d=a(window).height(),e=this.getStepTarget(b);return c="top"===b.placement?e.offset().top-d/2:"bottom"===b.placement?e.offset().top+e.height()-d/2:e.height()<=.8*d?e.offset().top-(d-e.height())/2:e.offset().top-.2*d,c=Math.max(0,c),c=Math.min(a(document).height()-d,c),Math.ceil(c)},c.prototype.calculateStepPositionInPage=function(){var b=a(window).height(),c=this.currentStepNode.height(),d=a(window).scrollTop(),e=a(window).width(),f=this.currentStepNode.width(),g=a(window).scrollLeft();return{top:Math.ceil(d+(b-c)/2),left:Math.ceil(g+(e-f)/2)}},c.prototype.positionStep=function(a){var c=this.currentStepNode;if(!c||!c.length)return this;var d=void 0;switch(a.placement){case"left":d=["left","right","top","bottom"];break;case"right":d=["right","left","top","bottom"];break;case"top":d=["top","bottom","right","left"];break;case"bottom":d=["bottom","top","right","left"];break;default:d="flip"}return this.currentStepPopper=new b(this.getStepTarget(a),c[0],{placement:a.placement+"-start",flipBehavior:d,removeOnDestroy:!0}),this},c.prototype.positionBackdrop=function(b){if(b.backdrop){this.currentStepConfig.hasBackdrop=!0;var c=a('<div data-flexitour="backdrop"></div>');if(b.zIndex?"append"===b.attachPoint?a(b.attachTo).append(c):c.insertAfter(a(b.attachTo)):a("body").append(c),this.isStepActuallyVisible(b)){var d=a('<div data-flexitour="step-background"></div>'),e=this.getStepTarget(b),f=10;f=0,d.css({width:2*f+e.outerWidth(),height:2*f+e.outerHeight(),left:f+e.offset().left,top:f+e.offset().top,backgroundColor:this.calculateInherittedBackgroundColor(e)});var g=e.css("borderRadius");g&&g!==a("body").css("borderRadius")&&d.css("borderRadius",g);var h=this.calculatePosition(e);h&&d.css("top",0);var i=d.clone();i.css({backgroundColor:c.css("backgroundColor"),opacity:c.css("opacity")}),i.attr("data-flexitour","step-background-fader"),b.zIndex?"append"===b.attachPoint?a(b.attachTo).append(d):(i.insertAfter(a(b.attachTo)),d.insertAfter(a(b.attachTo))):(a("body").append(i),a("body").append(d)),e.attr("data-flexitour","step-backdrop"),b.zIndex&&(c.css("zIndex",b.zIndex),d.css("zIndex",b.zIndex+1),e.css("zIndex",b.zIndex+2)),i.fadeOut("2000",function(){a(this).remove()})}}return this},c.prototype.calculateZIndex=function(b){for(b=a(b);b.length&&b[0]!==document;){var c=b.css("position");if("absolute"===c||"relative"===c||"fixed"===c){var d=parseInt(b.css("zIndex"),10);if(!isNaN(d)&&0!==d)return d}b=b.parent()}return 0},c.prototype.calculateInherittedBackgroundColor=function(b){var c=a("<div>").hide();a("body").append(c);var d=c.css("backgroundColor");for(c.remove(),b=a(b);b.length&&b[0]!==document;){var e=b.css("backgroundColor");if(e!==d)return e;b=b.parent()}return null},c.prototype.calculatePosition=function(b){for(b=a(b);b.length&&b[0]!==document;){var c=b.css("position");if("static"!==c)return c;b=b.parent()}return null},"object"===("undefined"==typeof exports?"undefined":d(exports))&&(module.exports=c),c});